{
	"$schema": "http://json-schema.org/draft-07/schema#",
	"type": "object",
	"required": ["type"],
	"allOf": [
		{ "$ref": "#/definitions/query" },
		{
			"oneOf": [
				{ "type": "object", "required": ["select"] },
				{ "type": "object", "required": ["group"] }
			]
		}
	],
	"definitions": {
		"subquery": {
			"type": "object",
			"allOf": [
				{ "not": { "required": ["id"] } },
				{ "$ref": "#/definitions/query" }
			]
		},
		"query": {
			"oneOf": [
				{ "$ref": "#/definitions/groupQuery" },
				{ "$ref": "#/definitions/selectQuery" }
			]
		},
		"groupQuery": {
			"type": "object",
			"required": ["group"],
			"additionalProperties": false,
			"properties": {
				"type": { "type": "string" },
				"ids": {},
				"where": {},
				"order": {},
				"limit": {},
				"offset": {},
				"meta": {},
				"group": {
					"type": "object",
					"additionalProperties": false,
					"required": ["by"],
					"properties": {
						"by": {
							"oneOf": [
								{
									"type": "array",
									"minItems": 1,
									"items": { "type": "string" }
								},
								{ "type": "string" }
							]
						},
						"select": {
							"oneOf": [
								{ "type": "string", "const": "*" },
								{ "$ref": "#/definitions/aggregationSelectClauseObject" },
								{
									"type": "array",
									"items": {
										"oneOf": [
											{ "type": "string" },
											{ "$ref": "#/definitions/aggregationSelectClauseObject" }
										]
									}
								}
							]
						},
						"aggregates": {
							"type": "object",
							"additionalProperties": { "$ref": "#/definitions/expression" }
						},
						"where": {},
						"order": {},
						"limit": {},
						"offset": {},
						"meta": {}
					}
				}
			}
		},
		"selectQuery": {
			"type": "object",
			"additionalProperties": false,
			"not": { "required": ["id", "ids"] },
			"properties": {
				"type": { "type": "string" },
				"select": { "anyOf": [{ "$ref": "#/definitions/selectClause" }, {}] },
				"id": {},
				"ids": {},
				"where": {},
				"order": {},
				"limit": {},
				"offset": {},
				"meta": {}
			}
		},
		"selectObject": {
			"type": "object",
			"properties": {
				"*": {}
			},
			"additionalProperties": {
				"anyOf": [
					{ "type": "string" },
					{ "$ref": "#/definitions/selectObject" },
					{ "$ref": "#/definitions/subquery" },
					{ "$ref": "#/definitions/expression" }
				]
			}
		},
		"selectClause": {
			"oneOf": [
				{ "type": "string" },
				{
					"type": "array",
					"items": {
						"oneOf": [
							{ "type": "string" },
							{ "$ref": "#/definitions/selectObject" }
						]
					}
				},
				{ "$ref": "#/definitions/selectObject" }
			]
		},
		"expression": {
			"type": "object",
			"minProperties": 1,
			"maxProperties": 1,
			"patternProperties": { "^\\$.*": {} }
		},
		"aggregationSelectClauseObject": {
			"type": "object",
			"additionalProperties": {
				"anyOf": [{ "type": "string" }, { "$ref": "#/definitions/expression" }]
			}
		}
	}
}
