{
	"$schema": "http://json-schema.org/draft-07/schema#",
	"type": "object",
	"required": ["type"],
	"allOf": [
		{ "$ref": "#/definitions/query" },
		{ "oneOf": [{ "required": ["select"] }, { "required": ["group"] }] }
	],
	"definitions": {
		"subquery": {
			"type": "object",
			"allOf": [
				{ "not": { "required": ["id"] } },
				{ "$ref": "#/definitions/query" }
			]
		},
		"query": {
			"oneOf": [
				{ "$ref": "#/definitions/groupQuery" },
				{ "$ref": "#/definitions/selectQuery" }
			]
		},
		"groupQuery": {
			"type": "object",
			"required": ["group"],
			"additionalProperties": false,
			"properties": {
				"type": { "type": "string" },
				"ids": { "type": "array", "items": { "type": ["string", "number"] } },
				"where": { "type": "object" },
				"order": { "$ref": "#/definitions/orderClause" },
				"limit": { "$ref": "#/definitions/limitClause" },
				"offset": { "$ref": "#/definitions/offsetClause" },
				"meta": {},
				"group": {
					"type": "object",
					"additionalProperties": false,
					"required": ["by"],
					"properties": {
						"by": {
							"oneOf": [
								{
									"type": "array",
									"minItems": 1,
									"items": { "type": "string" }
								},
								{ "type": "string" }
							]
						},
						"select": {
							"oneOf": [
								{ "type": "string", "const": "*" },
								{ "$ref": "#/definitions/aggregationSelectClauseObject" },
								{
									"type": "array",
									"items": {
										"oneOf": [
											{ "type": "string" },
											{ "$ref": "#/definitions/aggregationSelectClauseObject" }
										]
									}
								}
							]
						},
						"aggregates": {
							"type": "object",
							"additionalProperties": { "$ref": "#/definitions/expression" }
						},
						"where": { "type": "object" },
						"order": { "$ref": "#/definitions/orderClause" },
						"limit": { "$ref": "#/definitions/limitClause" },
						"offset": { "$ref": "#/definitions/offsetClause" },
						"meta": {}
					}
				}
			}
		},
		"selectQuery": {
			"type": "object",
			"additionalProperties": false,
			"not": { "required": ["id", "ids"] },
			"properties": {
				"type": { "type": "string" },
				"select": { "anyOf": [{ "$ref": "#/definitions/selectClause" }, {}] },
				"id": { "type": ["string", "number"] },
				"ids": { "type": "array", "items": { "type": ["string", "number"] } },
				"where": { "type": "object" },
				"order": { "$ref": "#/definitions/orderClause" },
				"limit": { "$ref": "#/definitions/limitClause" },
				"offset": { "$ref": "#/definitions/offsetClause" },
				"meta": {}
			}
		},
		"selectObject": {
			"type": "object",
			"properties": {
				"*": {}
			},
			"additionalProperties": {
				"anyOf": [
					{ "type": "string" },
					{ "$ref": "#/definitions/selectObject" },
					{ "$ref": "#/definitions/subquery" },
					{ "$ref": "#/definitions/expression" }
				]
			}
		},
		"expression": {
			"type": "object",
			"minProperties": 1,
			"maxProperties": 1,
			"patternProperties": { "^\\$.*": {} }
		},
		"aggregationSelectClauseObject": {
			"type": "object",
			"additionalProperties": {
				"anyOf": [{ "type": "string" }, { "$ref": "#/definitions/expression" }]
			}
		},
		"limitClause": { "type": "number", "minimum": 1 },
		"offsetClause": { "type": "number", "minimum": 0 },
		"orderClauseObject": {
			"type": "object",
			"minProperties": 1,
			"maxProperties": 1,
			"additionalProperties": {
				"type": "string",
				"enum": ["asc", "desc"]
			}
		},
		"orderClauseArray": {
			"type": "array",
			"items": { "$ref": "#/definitions/orderClauseObject" }
		},
		"orderClause": {
			"oneOf": [
				{ "$ref": "#/definitions/orderClauseArray" },
				{ "$ref": "#/definitions/orderClauseObject" }
			]
		},
		"selectClause": {
			"oneOf": [
				{ "type": "string", "const": "*" },
				{
					"type": "array",
					"items": {
						"oneOf": [
							{ "type": "string" },
							{ "$ref": "#/definitions/selectObject" }
						]
					}
				},
				{ "$ref": "#/definitions/selectObject" }
			]
		}
	}
}
